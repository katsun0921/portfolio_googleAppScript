<script>
  window.onload = function() {
    const value = google.script.run
    .withSuccessHandler(success)// 成功時のハンドラ
    .withFailureHandler(failure) // 失敗時のハンドラ
    .getValue();
  }

  function success(res) {
    const elmSkill = document.getElementById("skill");
    const elmCompany = document.getElementById("company");
    const skills = res.skillData;
    const companies = res.companyData;
    setOptions(elmSkill, skills);
    setOptions(elmCompany, companies);
  }

  function failure (value) {
    console.log(`failure: ${value}`);
  }

  function setOptions(elm, data) {
    for(const val of data) {
      let option = document.createElement("option");
      option.text = val.name;
      if (!!val.row) {
        option.value = val.row;
      }
      elm.appendChild(option);
    }
  }

  function submit() {
    const skills = document.querySelectorAll("#skill option");
    const company = document.querySelector("#company option:checked");
    const arrSkill = [];
    for ( const skill of skills ) {
      if ( skill.selected ) { arrSkill.push(skill.value); }
    }
    const cellId = `G${company.value}`;
    const opts = {
      cellId,
      items: arrSkill.join(",")
      };
    google.script.run.setSelectedValues(opts);
    google.script.host.close();
  }
</script>
